<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataViz AI Animator</title>
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <link rel="preconnect" href="[https://fonts.googleapis.com](https://fonts.googleapis.com)">
    <link rel="preconnect" href="[https://fonts.gstatic.com](https://fonts.gstatic.com)" crossorigin>
    <link href="[https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap](https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap)" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0A0A0A;
            color: #EAEAEA;
        }
        .main-container {
            min-height: 100vh;
        }
        .prompt-input {
            background-color: #1A1A1A;
            border: 1px solid #333;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .prompt-input:focus {
            outline: none;
            border-color: #4A90E2;
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.5);
        }
        .prompt-input.border-red-500 {
            border-color: #EF4444 !important;
        }
        .prompt-input.shadow-red-500:focus {
            box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.5) !important;
        }
        .control-label {
            background-color: #1A1A1A;
            border: 1px solid #333;
        }
        .control-label.active {
            background-color: #4A90E2;
            color: #FFFFFF;
            border-color: #4A90E2;
        }
        .btn-primary {
            background-color: #4A90E2;
            transition: background-color 0.3s;
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #357ABD;
        }
        .btn-primary:disabled {
            background-color: #333;
            cursor: not-allowed;
        }
        .loader {
            border-color: #4A90E2;
            border-top-color: transparent;
        }
        /* Ensured perfect centering for all states inside the video wrapper */
        .video-state-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #1A1A1A;
            border: 1px dashed #333;
            border-radius: 0.5rem; /* Corresponds to rounded-lg */
        }
        #video-container {
            border: none;
            background-color: transparent;
        }
    </style>
</head>
<body>
    <div class="main-container w-full flex flex-col items-center justify-center p-4 md:p-8">
        <div class="w-full max-w-4xl mx-auto">
            <!-- Header -->
            <header class="text-center mb-8">
                <h1 class="text-4xl md:text-5xl font-bold tracking-tighter">DataViz</h1>
                <p class="text-lg md:text-xl text-gray-400 mt-2">Transform Your Ideas into Motion with AI</p>
            </header>

            <!-- Main Content -->
            <main>
                <!-- Video Display Area -->
                <div id="video-wrapper" class="w-full aspect-video mb-6 relative">
                    <!-- The following containers are mutually exclusive and are toggled via JS -->
                    <div id="placeholder-container" class="video-state-container text-gray-500">
                        <svg xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="m3 21 8.02-8.02"></path><path d="m22 2-2.5 2.5"></path><path d="m13.5 13.5 2.5 2.5"></path><path d="M6 6s.5-1 2-2c1.5-1 3-2 3-2"></path><path d="M18 18s-1 .5-2 2c-1 1.5-2 3-2 3"></path></svg>
                        <p class="mt-2 text-lg">Let's create some magic</p>
                        <p class="text-sm text-gray-600">Enter a prompt below to get started</p>
                    </div>
                    
                    <div id="loader-container" class="video-state-container hidden text-white">
                        <div class="loader w-12 h-12 rounded-full border-4 animate-spin mb-4"></div>
                        <p id="status-text" class="text-lg text-center transition-opacity duration-300"></p>
                        <p class="text-sm text-gray-400 mt-1">(This can take a few minutes)</p>
                    </div>

                    <div id="video-container" class="video-state-container hidden !bg-transparent !border-none">
                        <video id="result-video" class="w-full h-full object-contain" controls></video>
                    </div>

                    <div id="error-container" class="video-state-container hidden text-red-400 p-4">
                        <svg xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                        <p class="mt-2 text-lg font-semibold">Generation Failed</p>
                        <p id="error-message" class="text-sm text-center mt-1"></p>
                    </div>
                </div>

                <!-- Prompt Input -->
                <div class="relative mb-4">
                    <textarea id="prompt" class="prompt-input w-full p-4 pr-12 rounded-lg text-base resize-none" rows="3" placeholder="e.g., An animation explaining the Pythagorean theorem"></textarea>
                </div>

                <!-- Controls -->
                <div class="flex flex-col md:flex-row gap-4 mb-6">
                    <!-- Orientation -->
                    <div class="flex-1">
                        <span class="text-sm font-medium text-gray-300 mb-2 block">Orientation</span>
                        <div id="orientation-group" class="grid grid-cols-2 gap-2">
                            <label class="control-label active text-center p-3 rounded-md cursor-pointer text-sm" data-value="landscape">
                                <input type="radio" name="orientation" value="landscape" class="sr-only" checked>Landscape
                            </label>
                            <label class="control-label text-center p-3 rounded-md cursor-pointer text-sm" data-value="portrait">
                                <input type="radio" name="orientation" value="portrait" class="sr-only">Portrait
                            </label>
                        </div>
                    </div>
                    <!-- Quality -->
                    <div class="flex-1">
                        <span class="text-sm font-medium text-gray-300 mb-2 block">Quality</span>
                         <div id="quality-group" class="grid grid-cols-3 gap-2">
                            <label class="control-label text-center p-3 rounded-md cursor-pointer text-sm" data-value="480p">
                                <input type="radio" name="quality" value="480p" class="sr-only">Fast
                            </label>
                            <label class="control-label active text-center p-3 rounded-md cursor-pointer text-sm" data-value="720p">
                                <input type="radio" name="quality" value="720p" class="sr-only" checked>Good
                            </label>
                             <label class="control-label text-center p-3 rounded-md cursor-pointer text-sm" data-value="1080p">
                                <input type="radio" name="quality" value="1080p" class="sr-only">Best
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Generate Button -->
                <button id="generate-btn" class="btn-primary w-full py-3 rounded-lg font-semibold text-lg">Generate</button>
            </main>
        </div>
    </div>

    <script>
        const generateBtn = document.getElementById('generate-btn');
        const promptInput = document.getElementById('prompt');
        const placeholderContainer = document.getElementById('placeholder-container');
        const loaderContainer = document.getElementById('loader-container');
        const statusText = document.getElementById('status-text');
        const videoContainer = document.getElementById('video-container');
        const resultVideo = document.getElementById('result-video');
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');
        let statusInterval;

        const allContainers = [placeholderContainer, loaderContainer, videoContainer, errorContainer];

        // --- State Management ---
        const showContainer = (containerToShow) => {
            allContainers.forEach(c => c.classList.add('hidden'));
            if (containerToShow) {
                containerToShow.classList.remove('hidden');
            }
        };
        
        const setLoadingState = (isLoading) => {
            generateBtn.disabled = isLoading;
            promptInput.disabled = isLoading;
            showContainer(isLoading ? loaderContainer : placeholderContainer);
        };

        const setVideoState = (videoUrl) => {
            showContainer(videoContainer);
            generateBtn.disabled = false;
            promptInput.disabled = false;
            resultVideo.src = videoUrl;
            resultVideo.load();
            resultVideo.play().catch(e => console.warn("Autoplay was prevented.", e));
        };
        
        const setErrorState = (message) => {
            showContainer(errorContainer);
            generateBtn.disabled = false;
            promptInput.disabled = false;
            errorMessage.textContent = message || 'An unknown error occurred. Please check the server logs.';
        };

        // --- Event Listeners ---
        generateBtn.addEventListener('click', async () => {
            const prompt = promptInput.value.trim();
            if (!prompt) {
                promptInput.focus();
                promptInput.classList.add('border-red-500', 'shadow-red-500');
                setTimeout(() => {
                    promptInput.classList.remove('border-red-500', 'shadow-red-500');
                }, 2000);
                return;
            }

            const orientation = document.querySelector('input[name="orientation"]:checked').value;
            const quality = document.querySelector('input[name="quality"]:checked').value;
            
            setLoadingState(true);

            // Dynamic Status Updates
            const statuses = [
                "Enhancing your idea...",
                "Designing the visuals...",
                "Writing the animation code...",
                "Rendering the video frames..."
            ];
            let statusIndex = 0;
            
            statusText.textContent = statuses[statusIndex];
            statusInterval = setInterval(() => {
                statusIndex = (statusIndex + 1) % statuses.length; // Cycle through statuses
                if (statusIndex < statuses.length) {
                    statusText.style.opacity = 0;
                    setTimeout(() => {
                        statusText.textContent = statuses[statusIndex];
                        statusText.style.opacity = 1;
                    }, 300);
                }
            }, 5000);

            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt, orientation, quality }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.details || errorData.error || `HTTP error! status: ${response.status}`);
                }

                const videoBlob = await response.blob();
                const videoUrl = URL.createObjectURL(videoBlob);
                setVideoState(videoUrl);

            } catch (error) {
                console.error('Generation failed:', error);
                setErrorState(error.message);
            } finally {
                clearInterval(statusInterval);
            }
        });

        // Custom radio button group handler
        const setupRadioGroup = (groupId) => {
            const group = document.getElementById(groupId);
            group.addEventListener('click', (e) => {
                const label = e.target.closest('label');
                if (label) {
                    group.querySelectorAll('label').forEach(lbl => lbl.classList.remove('active'));
                    label.classList.add('active');
                    label.querySelector('input').checked = true;
                }
            });
        };
        
        setupRadioGroup('orientation-group');
        setupRadioGroup('quality-group');
    </script>
</body>
</html>


